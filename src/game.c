#include "rogue.h"
#include "game.h"
#include "level.h"
#include "utils.h"
#include "position.h"






void render(Game* game){

    clear();
    printGameHub(game->levels[game->currentLevel - 1]);
    drawLevel(game->levels[game->currentLevel - 1]);
}

void gameLoop(Game* game){

const char* logoWin[] = {

"      _____                   _______                   _____                            _____                   _______                   _____      ",    
"     |\\    \\                 /::\\    \\                 /\\    \\                          /\\    \\                 /::\\    \\                 /\\    \\         ",
"     |:\\____\\               /::::\\    \\               /::\\____\\                        /::\\____\\               /::::\\    \\               /::\\____\\        ",
"     |::|   |              /::::::\\    \\             /:::/    /                       /:::/    /              /::::::\\    \\             /::::|   |        ",
"     |::|   |             /::::::::\\    \\           /:::/    /                       /:::/   _/___           /::::::::\\    \\           /:::::|   |        ",
"     |::|   |            /:::/~~\\:::\\    \\         /:::/    /                       /:::/   /\\    \\         /:::/~~\\:::\\    \\         /::::::|   |        ",
"     |::|   |           /:::/    \\:::\\    \\       /:::/    /                       /:::/   /::\\____\\       /:::/    \\:::\\    \\       /:::/|::|   |        ",
"     |::|   |          /:::/    / \\:::\\    \\     /:::/    /                       /:::/   /:::/    /      /:::/    / \\:::\\    \\     /:::/ |::|   |        ",
"     |::|___|______   /:::/____/   \\:::\\____\\   /:::/    /      _____            /:::/   /:::/   _/___   /:::/____/   \\:::\\____\\   /:::/  |::|   | _____  ",
"     /::::::::\\    \\ |:::|    |     |:::|    | /:::/____/      /\\    \\          /:::/___/:::/   /\\    \\ |:::|    |     |:::|    | /:::/   |::|   |/\\    \\", 
"    /::::::::::\\____\\|:::|____|     |:::|    ||:::|    /      /::\\____\\        |:::|   /:::/   /::\\____\\|:::|____|     |:::|    |/:: /    |::|   /::\\____\\ ",
"   /:::/~~~~/~~       \\:::\\    \\   /:::/    / |:::|____\\     /:::/    /        |:::|__/:::/   /:::/    / \\:::\\    \\   /:::/    / \\::/    /|::|  /:::/    / ",
"  /:::/    /           \\:::\\    \\ /:::/    /   \\:::\\    \\   /:::/    /          \\:::\\/:::/   /:::/    /   \\:::\\    \\ /:::/    /   \\/____/ |::| /:::/    / ",
" /:::/    /             \\:::\\    /:::/    /     \\:::\\    \\ /:::/    /            \\::::::/   /:::/    /     \\:::\\    /:::/    /            |::|/:::/    /  ",
"/:::/    /               \\:::\\__/:::/    /       \\:::\\    /:::/    /              \\::::/___/:::/    /       \\:::\\__/:::/    /             |::::::/    /   ",
"\\::/    /                 \\::::::::/    /         \\:::\\__/:::/    /                \\:::\\__/:::/    /         \\::::::::/    /              |:::::/    /    ",
" \\/____/                   \\::::::/    /           \\::::::::/    /                  \\::::::::/    /           \\::::::/    /               |::::/    /     ",
"                            \\::::/    /             \\::::::/    /                    \\::::::/    /             \\::::/    /                /:::/    /      ",
"                             \\::/____/               \\::::/    /                      \\::::/    /               \\::/____/                /:::/    /       ",
"                              ~~                      \\::/____/                        \\::/____/                 ~~                      \\::/    /        ",
"                                                       ~~                               ~~                                                \\/____/         ",
NULL                                                                                                                                                          
};


const char* logoLose[] = {

"      _____                   _______                   _____                            _____                    _____                    _____                    _____          ",
"     |\\    \\                 /::\\    \\                 /\\    \\                          /\\    \\                  /\\    \\                  /\\    \\                  /\\    \\         ",
"     |:\\____\\               /::::\\    \\               /::\\____\\                        /::\\    \\                /::\\    \\                /::\\    \\                /::\\    \\        ",
"     |::|   |              /::::::\\    \\             /:::/    /                       /::::\\    \\               \\:::\\    \\              /::::\\    \\              /::::\\    \\       ",
"     |::|   |             /::::::::\\    \\           /:::/    /                       /::::::\\    \\               \\:::\\    \\            /::::::\\    \\            /::::::\\    \\      ",
"     |::|   |            /:::/~~\\:::\\    \\         /:::/    /                       /:::/\\:::\\    \\               \\:::\\    \\          /:::/\\:::\\    \\          /:::/\\:::\\    \\     ",
"     |::|   |           /:::/    \\:::\\    \\       /:::/    /                       /:::/  \\:::\\    \\               \\:::\\    \\        /:::/__\\:::\\    \\        /:::/  \\:::\\    \\    ",
"     |::|   |          /:::/    / \\:::\\    \\     /:::/    /                       /:::/    \\:::\\    \\              /::::\\    \\      /::::\\   \\:::\\    \\      /:::/    \\:::\\    \\   ",
"     |::|___|______   /:::/____/   \\:::\\____\\   /:::/    /      _____            /:::/    / \\:::\\    \\    ____    /::::::\\    \\    /::::::\\   \\:::\\    \\    /:::/    / \\:::\\    \\  ",
"     /::::::::\\    \\ |:::|    |     |:::|    | /:::/____/      /\\    \\          /:::/    /   \\:::\\ ___\\  /\\   \\  /:::/\\:::\\    \\  /:::/\\:::\\   \\:::\\    \\  /:::/    /   \\:::\\ ___\\ ",
"    /::::::::::\\____\\|:::|____|     |:::|    ||:::|    /      /::\\____\\        /:::/____/     \\:::|    \\|/::\\   \\/:::/  \\:::\\____\\/:::/__\\:::\\   \\:::\\____\\/:::/____/     \\:::|    | ",
"   /:::/~~~~/~~       \\:::\\    \\   /:::/    / |:::|____\\     /:::/    /        \\:::\\    \\     /:::|____|\\:::\\  /:::/    \\::/    /\\:::\\   \\:::\\   \\::/    /\\:::\\    \\     /:::|____| ",
"  /:::/    /           \\:::\\    \\ /:::/    /   \\:::\\    \\   /:::/    /          \\:::\\    \\   /:::/    /  \\:::\\/:::/    / \\/____/  \\:::\\   \\:::\\   \\/____/  \\:::\\    \\   /:::/    /  ",
" /:::/    /             \\:::\\    /:::/    /     \\:::\\    \\ /:::/    /            \\:::\\    \\ /:::/    /    \\::::::/    /            \\:::\\   \\:::\\    \\       \\:::\\    \\ /:::/    /  ",
"/:::/    /               \\:::\\__/:::/    /       \\:::\\    /:::/    /              \\:::\\    /:::/    /      \\::::/____/              \\:::\\   \\:::\\____\\       \\:::\\    /:::/    /   ",
"\\::/    /                 \\::::::::/    /         \\:::\\__/:::/    /                \\:::\\  /:::/    /        \\:::\\    \\               \\:::\\   \\::/    /        \\:::\\  /:::/    /    ",
" \\/____/                   \\::::::/    /           \\::::::::/    /                  \\:::\\/:::/    /          \\:::\\    \\               \\:::\\   \\/____/          \\:::\\/:::/    /     ",
"                            \\::::/    /             \\::::::/    /                    \\::::::/    /            \\:::\\    \\               \\:::\\    \\               \\::::::/    /      ",
"                             \\::/____/               \\::::/    /                      \\::::/    /              \\:::\\____\\               \\:::\\____\\               \\::::/    /       ",
"                              ~~                      \\::/____/                        \\::/____/                \\::/    /                \\::/    /                \\::/____/        ",
"                                                       ~~                               ~~                       \\/____/                  \\/____/                  ~~              ",                                                                                                                                                                              
NULL
};

    Mix_ResumeMusic();
    usleep(100000);
    int ch = '\0';
    Position* newPosition;
    Level* level;

    if (game->currentLevel == 0){

        game->levels[game->currentLevel] = createLevel(1);
        game->currentLevel++;
    }

    // if (game->currentLevel == 1){

    //     game->levels[game->currentLevel] = createLevel(2);
    //     game->currentLevel++;
    // }

    // if (game->currentLevel == 2){

    //     game->levels[game->currentLevel] = createLevel(3);
    //     game->currentLevel++;
    // }

    // if (game->currentLevel == 3){

    //     game->levels[game->currentLevel] = createLevel(4);
    //     game->currentLevel++;
    // }


    level = game->levels[game->currentLevel - 1];


    /* main game loop */
    while (1){


        if(ch == 'q')
            break;

        if(ch == 'i'){
            printInventory(level->user);
        }

        else{

            newPosition = handleInput(ch, level->user);
            checkPostion(newPosition, level);
            moveMonsters(level);

            render(game);

            if (level->user->health <= 0){

                game->currentLevel = 0;
                clear();
                for (int i = 0; logoLose[i] != NULL; i++) {
                    mvprintw(i + 6, 20, "%s", logoLose[i]);
                }
                getch();
                return;
            }

            if (level->user->exp >= 1000){

                game->currentLevel = 0;
                clear();
                for (int i = 0; logoWin[i] != NULL; i++) {
                    mvprintw(i + 6, 20, "%s", logoWin[i]);
                }
                getch();
                return;
            }
        }
        
        ch = getch();
    }
}
